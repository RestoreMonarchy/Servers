@using Core.Models;
@inject IJSRuntime JsRuntime
@attribute [Authorize(Roles = "Admin, Moderator")]

<div class="modal fade" id="productModal" tabindex="-1" role="dialog" aria-labelledby="productLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">@(IsEdit ? "Update" : "Create") Product</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            @if (Product != null)
            {
                <EditForm Model="@Product" OnValidSubmit="onSumbit">
                    <div class="modal-body">
                        <DataAnnotationsValidator />
                        <div class="form-group">
                            <label for="name">Label</label>
                            <InputText id="name" class="form-control" @bind-Value="@Product.Label" />
                            <div class="validation-message">
                                <ValidationMessage For="@(() => Product.Label)" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="description">Details</label>
                            <InputTextArea rows="8" id="descirption" class="form-control" @bind-Value="@Product.Details" />
                            <div class="validation-message">
                                <ValidationMessage For="@(() => Product.Details)" />
                            </div>
                        </div>
                        @*<div class="form-group">
                            <label for="image">Image</label>
                            <input type="file" class="form-control is-valid" @onchange="SetImage" id="fileUpload" />
                            @if (Product.Image != null)
                            {
                                <img src="data:image;base64,@Convert.ToBase64String(Product.Image)" style="max-width: 150px;" />
                            }   
                            <div class="validation-message">
                                <ValidationMessage For="@(() => Product.Image)" />
                            </div>
                        </div>*@

                        <!-- TODO: Add image upload for products -->
                        @*<div class="form-group">
                            <label for="price">Image</label>
                            <input type="file" id="price" class="form-control" @bind="@Product.Image" />                            
                            <img src="data:image;base64,@Convert.ToBase64String(Product.Image)" style="max-width: 150px;"/>
                            <div class="validation-message">
                                <ValidationMessage For="@(() => Product.Price)" />
                            </div>
                        </div>*@
                        <div class="form-group">
                            <label for="category">Category</label>
                            <InputSelect id="category" class="form-control" @bind-Value="@Product.Category">
                                <option value="">Select Category</option>
                                <option value="ranks">Ranks</option>
                                <option value="kits">Kits</option>
                                <option value="extras">Extras</option>
                            </InputSelect>
                            <div class="validation-message">
                                <ValidationMessage For="@(() => Product.Category)" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="price">Price</label>
                            <InputNumber id="price" class="form-control" @bind-Value="@Product.Price" />
                            <div class="validation-message">
                                <ValidationMessage For="@(() => Product.Price)" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="duration">Duration</label>
                            <InputNumber id="duration" class="form-control" @bind-Value="@Product.Duration" />
                            <div class="validation-message">
                                <ValidationMessage For="@(() => Product.Duration)" />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button class="btn btn-primary" type="submit">@(IsEdit ? "Update" : "Create")</button>
                    </div>
                </EditForm>
            }
        </div>
    </div>
</div>

@code {
    [Parameter]
    public bool IsEdit { get; set; }

    [Parameter]
    public Product Product { get; set; }

    [Parameter]
    public EventCallback<Product> OnSubmitted { get; set; }

    private async Task onSumbit()
    {
        await JsRuntime.InvokeVoidAsync("HideModal", "productModal");
        await OnSubmitted.InvokeAsync(Product);
    }

    //async Task SetImage()
    //{
    //    string data = await JsRuntime.InvokeAsync<string>("getFileData", "fileUpload");
    //    Product.Image = Convert.FromBase64String(data);
    //}
}
